{"ignition":{"config":{},"security":{"tls":{}},"timeouts":{},"version":"2.2.0"},"networkd":{},"passwd":{"users":[{"name":"core","sshAuthorizedKeys":["ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1JnaVPFjGDuhzVUTNSug8TPqyCO14rsxSJ6fJiWJTj9LkqSoJ7SJy0NiLPWXygsnM6cvibpPZrDrmwqGHwTLlhnurbEUA8EvsddxOPkOzX+diMd6xthFMcdTYXS+sQQ9cPB6otrZai7GsAiT7OEQutF7g1JXIpzt1jBd8P+S3p5B5Av+AuDkSHwwvC8Y0IREQLBzitCQP9I9Mrw5KVS5uwVHajYri0s8ZvsXXJtxBUaWjRxFpyjvkL0NDPanfwdxQP3X0z2crY/RMr72dwjk0P74QQmfoD9juD3J8/9BkdWKLuhQTvTShduqhAJK9XXj2/pQj/IuM1ZSALVIW/Dgr"]}]},"storage":{"files":[{"filesystem":"root","path":"/etc/coredns/dynamic-update.py","contents":{"source":"data:,import%20SimpleHTTPServer%0Aimport%20SocketServer%0Aimport%20json%0A%0A%23%20Edit%20these%20to%20suit%20your%20needs%3A%0APORT%20%3D%208080%0ADOMAIN%20%3D%20%22shiftstack.ci%22%0ACOREDB_FILE%20%3D%20%22%2Fetc%2Fcoredns%2Fdb.%7B%7D%22.format(DOMAIN)%0A%0A%0A%23%20You%20should%20probably%20not%20touch%20these%20unless%20you%20want%20to%20hardcode%20some%20records%0ACOREDB_TEMPLATE%20%3D%20%22%22%22%0A%24ORIGIN%20%7Bdomain%7D.%0A%40%20%20%20%203600%20IN%20SOA%20%7Bdomain%7D.%20hostmaster%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Bserial%7D%20%3B%20serial%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%207200%20%20%20%20%20%20%20%3B%20refresh%20(2%20hours)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%203600%20%20%20%20%20%20%20%3B%20retry%20(1%20hour)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201209600%20%20%20%20%3B%20expire%20(2%20weeks)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%203600%20%20%20%20%20%20%20%3B%20minimum%20(1%20hour)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%7Bentries%7D%0A%22%22%22%0AENTRIES%20%3D%20%7B%7D%0ASERIAL_NUMBER%20%3D%200%0A%0A%0Adef%20build_coredb_file(domain%2C%20serial_number%2C%20entries)%3A%0A%20%20%20%20formatted_entries%20%3D%20'%5Cn'.join(%22%7B%7D%20IN%20A%20%7B%7D%22.format(name%2C%20ip)%20for%20name%2C%20ip%0A%20%20%20%20%20%20%20%20in%20entries.iteritems())%0A%20%20%20%20return%20COREDB_TEMPLATE.format(domain%3Ddomain%2C%20serial%3Dserial_number%2C%0A%20%20%20%20%20%20%20%20entries%3Dformatted_entries)%0A%0A%0Aclass%20ServerHandler(SimpleHTTPServer.SimpleHTTPRequestHandler)%3A%0A%20%20%20%20def%20do_POST(self)%3A%0A%20%20%20%20%20%20%20%20global%20ENTRIES%0A%20%20%20%20%20%20%20%20global%20SERIAL_NUMBER%0A%20%20%20%20%20%20%20%20global%20DOMAIN%0A%20%20%20%20%20%20%20%20content_len%20%3D%20int(self.headers.getheader('content-length'%2C%200))%0A%20%20%20%20%20%20%20%20post_body%20%3D%20self.rfile.read(content_len)%0A%20%20%20%20%20%20%20%20body%20%3D%20%22%22%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20body%20%3D%20json.loads(post_body)%0A%20%20%20%20%20%20%20%20except%20Exception%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.send_response(422)%0A%20%20%20%20%20%20%20%20%20%20%20%20print%20%22Error%2C%20invalid%20JSON%3A%20%7B%7D%22.format(post_body)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%0A%20%20%20%20%20%20%20%20self.send_response(200)%0A%20%20%20%20%20%20%20%20if%20'name'%20in%20body%20and%20'ip'%20in%20body%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20ENTRIES%5Bbody%5B'name'%5D%5D%20%3D%20body%5B'ip'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20SERIAL_NUMBER%20%2B%3D%201%0A%20%20%20%20%20%20%20%20%20%20%20%20db%20%3D%20build_coredb_file(DOMAIN%2C%20SERIAL_NUMBER%2C%20ENTRIES)%0A%20%20%20%20%20%20%20%20%20%20%20%20print%20%22Writing%20version%20%7B%7D%20to%20file%20%7B%7D%22.format(SERIAL_NUMBER%2C%20COREDB_FILE)%0A%20%20%20%20%20%20%20%20%20%20%20%20with%20open(COREDB_FILE%2C%20'w')%20as%20f%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f.write(db)%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print%20%22Invalid%20format%20of%20body%22%2C%20repr(body)%0A%0A%0Aif%20__name__%20%3D%3D%20'__main__'%3A%0A%20%20%20%20Handler%20%3D%20ServerHandler%0A%20%20%20%20httpd%20%3D%20SocketServer.TCPServer((%22%22%2C%20PORT)%2C%20Handler)%0A%20%20%20%20print%20%22serving%20at%20port%22%2C%20PORT%0A%20%20%20%20httpd.serve_forever()%0A","verification":{}},"mode":420},{"filesystem":"root","path":"/etc/coredns/Corefile","contents":{"source":"data:,.%20%7B%0A%20%20%20%20log%0A%20%20%20%20errors%0A%0A%20%20%20%20forward%20.%20%2Fetc%2Fresolv.conf%20%7B%0A%20%20%20%20%20%20%20%20except%20shiftstack.ci%0A%20%20%20%20%7D%0A%7D%0A%0Ashiftstack.ci%20%7B%0A%20%20%20%20log%0A%20%20%20%20errors%0A%0A%20%20%20%20file%20%2Fetc%2Fcoredns%2Fdb.shiftstack.ci%20%7B%0A%20%20%20%20%20%20%20%20reload%2010s%0A%20%20%20%20%7D%0A%7D%0A","verification":{}},"mode":420},{"filesystem":"root","path":"/etc/coredns/db.shiftstack.ci","contents":{"source":"data:,%24ORIGIN%20shiftstack.ci.%0A%40%20%20%20%203600%20IN%20SOA%20dns.shiftstack.ci.%20hostmaster%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%202017042752%20%3B%20serial%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%207200%20%20%20%20%20%20%20%3B%20refresh%20(2%20hours)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%203600%20%20%20%20%20%20%20%3B%20retry%20(1%20hour)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201209600%20%20%20%20%3B%20expire%20(2%20weeks)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%203600%20%20%20%20%20%20%20%3B%20minimum%20(1%20hour)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A","verification":{}},"mode":420}]},"systemd":{"units":[{"contents":"[Unit]\nDescription=CI DNS\n\n[Service]\nExecStart=/bin/podman run --rm -i -t -m 128m --net host --cap-add=NET_ADMIN -v /etc/coredns:/etc/coredns:Z openshift/origin-coredns:v4.0 -conf /etc/coredns/Corefile\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"ci-dns.service"},{"contents":"[Unit]\nDescription=Dynamic DNS updater\n\n[Service]\nExecStart=/bin/python /etc/coredns/dynamic-update.py\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"dynamic-dns-updater.service"}]}}